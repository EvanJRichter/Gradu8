var gradu8Services=angular.module("gradu8Services",[]);gradu8Services.factory("CommonData",function(){var data="";return{getData:function(){return data},setData:function(newData){data=newData}}}),gradu8Services.factory("Llamas",function($http,$window){return{get:function(){var baseUrl=$window.sessionStorage.baseurl;return $http.get(baseUrl+"/api/llamas")}}}),gradu8Services.factory("srvAuth",function($http,$window,$rootScope){var watchLoginChangeLogic=function(){console.log("Watchin da change");var _self=this;FB.Event.subscribe("auth.authResponseChange",function(res){"connected"===res.status?(console.log("connected"),_self.getUserInfo(),console.log(res.authResponse)):console.log("notconnected")})},getUserInfoLogic=function(){var _self=this;FB.api("/me",function(res){$rootScope.$apply(function(){$rootScope.user=_self.user=res})})},logoutLogic=function(){var _self=this;FB.logout(function(response){$rootScope.$apply(function(){$rootScope.user=_self.user={}})})},testAPILogic=function(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(response){console.log("Successful login for: "+response.name),document.getElementById("status").innerHTML="Thanks for logging in, "+response.name+"!"})};return{watchLoginChange:watchLoginChangeLogic,getUserInfo:getUserInfoLogic,logout:logoutLogic,testAPI:testAPILogic}}),mp4Services.factory("Users",function($http,$window){var baseUrl="http://localhost:3001",getUserHandler=function(userId){return $http.get(baseUrl+"/api/users/"+userId)},addUserHandler=function(fbId){return $http.post(baseUrl+"/api/users/",{facebookId:facebookId})},putUserProfileHandler=function(userObj){return $http.put(baseUrl+"/api/users/"+userObj._id,userObj)},getUserClassesHandler=function(fbId){var whereUrl='where={"facebookId":"'+fbId+'"}',selectUrl="select={classes:1}";return $http.get(baseUrl+"/api/users/?"+whereUrl+"&"+selectUrl)},addUserClassesHandler=function(fbId,classes){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data;userObj.classes.push(classes),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})},deleteUserClassHandler=function(fbId,_class){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data,index=userObj.classes.indexOf(_class);index>-1&&userObj.classes.splice(index,1),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})},getUserLabelsHandler=function(fbId){var whereUrl='where={"facebookId":"'+fbId+'"}',selectUrl="select={labels:1}";return $http.get(baseUrl+"/api/users/?"+whereUrl+"&"+selectUrl)},addUserLabelsHandler=function(fbId,labels){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data;userObj.labels.push(labels),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})},deleteUserLabelHandler=function(fbId,label){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data,index=userObj.labels.indexOf(label);index>-1&&userObj.labels.splice(index,1),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})};return{getFBUser:getFBUserHandler,getUser:getUserHandler,addUser:addUserHandler,putUserProfile:putUserProfileHandler,getUserClasses:getUserClassesHandler,addUserClasses:addUserClassesHandler,deleteUserClass:deleteUserClassHandler,getUserLabels:getUserLabelsHandler,addUserLabels:addUserLabelsHandler,deleteUserLabel:deleteUserLabelHandler}}),mp4Services.factory("Classes",function($http,$window){var baseUrl="http://localhost:3001",getClassHandler=function(classId){return $http.get(baseUrl+"/api/classes/"+classId)},getPublicClassesHandler=function(){var whereUrl='where={"public": true}',selectUrl="select={number:1,department:1,title:1}";return $http.get(baseUrl+"/api/classes/?"+whereUrl+"&"+selectUrl)},addClassHandler=function(){},updateClassHandler=function(){},deleteClassHandler=function(){};return{getClass:getClassHandler,getPublicClasses:getPublicClassesHandler,addClass:addClassHandler,updateClass:updateClassHandler,deleteClass:deleteClassHandler}}),mp4Services.factory("Labels",function($http,$window){var baseUrl="http://localhost:3001",getLabelHandler=function(labelId){return $http.get(baseUrl+"/api/labels/"+labelId)},getPublicLabelsHandler=function(){var whereUrl='where={"public": true}';return $http.get(baseUrl+"/api/labels/?"+whereUrl)},addLabelHandler=function(name,color){return $http.post(baseUrl+"/api/labels/",{name:name,color:color,"public":!1})},updateLabelHandler=function(labelId,name,color){return $http.put(baseUrl+"/api/labels/"+labelId,{name:name,color:color,"public":!1})},deleteLabelHandler=function(labelId){return getLabelHandler(labelId).success(function(data){var labelObj=data.data;$http["delete"](baseUrl+"/api/labels/"+labelObj._id)})};return{getLabel:getLabelHandler,getPublicLabels:getPublicLabelsHandler,addLabel:addLabelHandler,updateLabel:updateLabelHandler,deleteLabel:deleteLabelHandler}});