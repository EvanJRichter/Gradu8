var gradu8Services=angular.module("gradu8Services",[]);gradu8Services.factory("CommonData",function(){var data="";return{getData:function(){return data},setData:function(newData){data=newData}}}),gradu8Services.factory("Llamas",function($http,$window){return{get:function(){var baseUrl=$window.sessionStorage.baseurl;return $http.get(baseUrl+"/api/llamas")}}}),gradu8Services.factory("srvAuth",function($http,$window,$rootScope){var user={mongoId:0,facebookId:0},watchLoginChangeLogic=function(){var _self=this;FB.Event.subscribe("auth.authResponseChange",function(res){"connected"===res.status?(console.log("connected"),_self.setUserInfo(),console.log(res.authResponse)):console.log("notconnected")})},setUserInfoLogic=function(){var _self=this;FB.api("/me",function(res){$rootScope.$apply(function(){$rootScope.user=_self.user=res})})},logoutLogic=function(){var _self=this;FB.logout(function(response){$rootScope.$apply(function(){$rootScope.user=_self.user={}})})},testAPILogic=function(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(response){console.log("Successful login for: "+response.name),document.getElementById("status").innerHTML="Thanks for logging in, "+response.name+"!"})},getUserLogic=function(){return user},getUserMongoIdLogic=function(){return user.mongoId},getUserFacebookIdLogic=function(){return user.facebookId},setUserMongoIdLogic=function(mongoId){user.mongoId=mongoId},setUserFacebookIdLogic=function(facebookId){user.facebookId=facebookId};return{watchLoginChange:watchLoginChangeLogic,setUserInfo:setUserInfoLogic,getUser:getUserLogic,getUserMongoId:getUserMongoIdLogic,getUserFacebookId:getUserFacebookIdLogic,setUserMongoId:setUserMongoIdLogic,setUserFacebookId:setUserFacebookIdLogic,logout:logoutLogic,testAPI:testAPILogic}}),gradu8Services.factory("Users",function($http,$window){var baseUrl="http://localhost:3001",getUserFBHandler=function(fbId){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl)},getUserHandler=function(userId){return $http.get(baseUrl+"/api/users/"+userId)},addUserHandler=function(fbId){return $http.post(baseUrl+"/api/users/",{facebookId:fbId})},putUserHandler=function(userObj){return console.log("put services",userObj),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)},getUserClassesHandler=function(fbId){var whereUrl='where={"facebookId":"'+fbId+'"}',selectUrl="select={classes:1}";return $http.get(baseUrl+"/api/users/?"+whereUrl+"&"+selectUrl)},addUserClassesHandler=function(userId,classes){var promise=$http.get(baseUrl+"/api/users/"+userId).success(function(data){var userObj=data.data;return console.log("addUserClassesHandler, passed first get. User:",data),userObj.classes?userObj.classes.push(classes):userObj.classes=classes,$http.put(baseUrl+"/api/users/"+userObj._id,userObj)});return promise},deleteUserClassHandler=function(fbId,_class){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data,index=userObj.classes.indexOf(_class);index>-1&&userObj.classes.splice(index,1),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})},getUserLabelsHandler=function(fbId){var whereUrl='where={"facebookId":"'+fbId+'"}',selectUrl="select={labels:1}";return $http.get(baseUrl+"/api/users/?"+whereUrl+"&"+selectUrl)},addUserLabelsHandler=function(fbId,labels){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data;userObj.labels.push(labels),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})},deleteUserLabelHandler=function(fbId,label){var whereUrl='where={"facebookId":"'+fbId+'"}';return $http.get(baseUrl+"/api/users/?"+whereUrl).success(function(data){var userObj=data.data,index=userObj.labels.indexOf(label);index>-1&&userObj.labels.splice(index,1),$http.put(baseUrl+"/api/users/"+userObj._id,userObj)})};return{getFBUser:getUserFBHandler,getUser:getUserHandler,addUser:addUserHandler,putUser:putUserHandler,getUserClasses:getUserClassesHandler,addUserClasses:addUserClassesHandler,deleteUserClass:deleteUserClassHandler,getUserLabels:getUserLabelsHandler,addUserLabels:addUserLabelsHandler,deleteUserLabel:deleteUserLabelHandler}}),gradu8Services.factory("Classes",function($http,$window){var baseUrl="http://localhost:3001",getDepartmentsHandler=function(){var distinctUrl='distinct="department"';return $http.get(baseUrl+"/api/classes/?"+distinctUrl)},getClassHandler=function(classId){return $http.get(baseUrl+"/api/classes/"+classId)},getPublicClassesHandler=function(){var whereUrl='where={"public": true}&limit=1000';return $http.get(baseUrl+"/api/classes/?"+whereUrl)},getDepartmentClassesHandler=function(department){var whereUrl='where={"department": "'+department+'"}';return $http.get(baseUrl+"/api/classes/?"+whereUrl)},addClassHandler=function(){},updateClassHandler=function(){},deleteClassHandler=function(){};return{getDepartments:getDepartmentsHandler,getClass:getClassHandler,getPublicClasses:getPublicClassesHandler,getDepartmentClasses:getDepartmentClassesHandler,addClass:addClassHandler,updateClass:updateClassHandler,deleteClass:deleteClassHandler}}),gradu8Services.factory("Labels",function($http,$window){var baseUrl="http://localhost:3001",getLabelHandler=function(labelId){return $http.get(baseUrl+"/api/labels/"+labelId)},getPublicLabelsHandler=function(){var whereUrl='where={"public": true}';return $http.get(baseUrl+"/api/labels/?"+whereUrl)},addLabelHandler=function(name,color){return $http.post(baseUrl+"/api/labels/",{name:name,color:color,"public":!1})},updateLabelHandler=function(labelId,name,color){return $http.put(baseUrl+"/api/labels/"+labelId,{name:name,color:color,"public":!1})},deleteLabelHandler=function(labelId){return getLabelHandler(labelId).success(function(data){var labelObj=data.data;$http["delete"](baseUrl+"/api/labels/"+labelObj._id)})};return{getLabel:getLabelHandler,getPublicLabels:getPublicLabelsHandler,addLabel:addLabelHandler,updateLabel:updateLabelHandler,deleteLabel:deleteLabelHandler}}),gradu8Services.factory("Majors",function($http,$window){var baseUrl="http://localhost:3001",getAllMajorsHandler=function(majorId){return $http.get(baseUrl+"/api/majors")},getMajorHandler=function(majorId){return $http.get(baseUrl+"/api/majors/"+majorId)};return{getAllMajors:getAllMajorsHandler,getMajor:getMajorHandler}}),gradu8Services.factory("Minors",function($http,$window){var baseUrl="http://localhost:3001",getAllMinorsHandler=function(majorId){return $http.get(baseUrl+"/api/minors")},getMinorHandler=function(minorId){return $http.get(baseUrl+"/api/minors/"+minorId)};return{getAllMinors:getAllMinorsHandler,getMinor:getMinorHandler}}),gradu8Services.factory("Universities",function($http,$window){var baseUrl="http://localhost:3001",getAllSchoolsHandler=function(majorId){return $http.get(baseUrl+"/api/schools")},getSchoolHandler=function(majorId){return $http.get(baseUrl+"/api/schools/"+majorId)};return{getAllSchools:getAllSchoolsHandler,getSchool:getSchoolHandler}});